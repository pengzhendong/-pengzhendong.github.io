<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"pengzhendong.cn",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"39IHYBUVGR",apiKey:"4287c8f8a629343c8d2212e108417ceb",indexName:"Notes",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言 开完题了，论文的审稿意见也下来了。不出意料，有两个评委给了 No，一个给了 Yes。值得开心的是他们都说这是一个新颖的想法，不足还是自己的写作方面，没有把模型说清楚，而且实验做的也不够充分，接下来可能就是要慢慢改了。循环神经网络部分的实验内容也总结完了，虽然还是模模糊糊，但是这些东西大体上在我看来也没那么高深莫测，倒是一些细节方面确实挺难的。"><meta name="keywords" content="Deep Learning"><meta property="og:type" content="article"><meta property="og:title" content="卷积与滤波器"><meta property="og:url" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/index.html"><meta property="og:site_name" content="Randy&#39;s Notes"><meta property="og:description" content="前言 开完题了，论文的审稿意见也下来了。不出意料，有两个评委给了 No，一个给了 Yes。值得开心的是他们都说这是一个新颖的想法，不足还是自己的写作方面，没有把模型说清楚，而且实验做的也不够充分，接下来可能就是要慢慢改了。循环神经网络部分的实验内容也总结完了，虽然还是模模糊糊，但是这些东西大体上在我看来也没那么高深莫测，倒是一些细节方面确实挺难的。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/lena.png"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/a.png"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/b.png"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/c.png"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/d.png"><meta property="og:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/sobel.png"><meta property="og:updated_time" content="2018-11-20T12:34:36.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="卷积与滤波器"><meta name="twitter:description" content="前言 开完题了，论文的审稿意见也下来了。不出意料，有两个评委给了 No，一个给了 Yes。值得开心的是他们都说这是一个新颖的想法，不足还是自己的写作方面，没有把模型说清楚，而且实验做的也不够充分，接下来可能就是要慢慢改了。循环神经网络部分的实验内容也总结完了，虽然还是模模糊糊，但是这些东西大体上在我看来也没那么高深莫测，倒是一些细节方面确实挺难的。"><meta name="twitter:image" content="https://pengzhendong.cn/2018/11/20/convolution-and-filters/lena.png"><link rel="canonical" href="https://pengzhendong.cn/2018/11/20/convolution-and-filters/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><style type="text/css">body{background-image:url(/images/rockywall.png)}</style><title>卷积与滤波器 | Randy's Notes</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92548519-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-92548519-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?06c54470f22c395ef480d6fb358497d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Randy's Notes</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-友链"><a href="/friends/" rel="section"><i class="fa fa-users fa-fw"></i> 友链</a></li><li class="menu-item menu-item-书单"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i> 书单</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/pengzhendong" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pengzhendong.cn/2018/11/20/convolution-and-filters/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Randy Peng"><meta itemprop="description" content="路漫漫其修远兮 吾将上下而求索"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Randy's Notes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 卷积与滤波器</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-11-20 16:16:03 / 修改时间：20:34:36" itemprop="dateCreated datePublished" datetime="2018-11-20T16:16:03+08:00">2018-11-20</time></span><span id="/2018/11/20/convolution-and-filters/" class="post-meta-item leancloud_visitors" data-flag-title="卷积与滤波器" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>0</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言">前言</h2><p>开完题了，论文的审稿意见也下来了。不出意料，有两个评委给了 No，一个给了 Yes。值得开心的是他们都说这是一个新颖的想法，不足还是自己的写作方面，没有把模型说清楚，而且实验做的也不够充分，接下来可能就是要慢慢改了。循环神经网络部分的实验内容也总结完了，虽然还是模模糊糊，但是这些东西大体上在我看来也没那么高深莫测，倒是一些细节方面确实挺难的。</p><a id="more"></a><h2 id="卷积运算">卷积运算</h2><p>在学习卷积神经网络之前需要再好好巩固一下什么是卷积运算，然后顺便把大四学习的滤波器的内容总结一下。知乎上有不少通俗易懂的解释可以参考<a href="https://www.zhihu.com/question/22298352" target="_blank" rel="noopener">通俗易懂地理解卷积</a>，其实卷积是之前在<a href="/2018/06/06/Optimization-algorithms">优化算法</a>中提到的移动平均的推广。</p><h3 id="定义">定义</h3><p><span class="math inline">\(f\)</span> 和 <span class="math inline">\(g\)</span> 的卷积写为 <span class="math inline">\((f*g)(n)\)</span>，其离散的定义为： <span class="math display">\[ (f*g)[n]=\sum_{\tau=-\infty}^\infty f[\tau]g[n-\tau] \]</span> 连续的定义为：</p><p><span class="math display">\[ (f*g)(n)=\int_{-\infty}^\infty f(\tau)g(n-\tau)d\tau \]</span> 其中 <span class="math inline">\(n=\tau+(n-\tau)\)</span>，借鉴一下马同学在知乎中的<a href="如何通俗易懂地解释卷积？%20-%20马同学的回答%20-%20知乎%20https://www.zhihu.com/question/22298352/answer/228543288">例子</a>，离散卷积的应用场景：两个普通骰子点数加起来等于四的概率。 <span class="math display">\[ f[1]g[3]+f[2]g[2]+f[3]g[1] \]</span> 符合卷积的定义，写成标准形式就是： <span class="math display">\[ (f*g)[4]=\sum_{m=1}^3f[4-m]g[m] \]</span> 连续卷积的应用场景：追踪飞船的位置 <span class="math inline">\(f(t)\)</span>，由于噪声的影响，我们需要对得到的结果进行加权平均，时间上越近的测量结果越相关，相关函数为 <span class="math inline">\(g(t)\)</span>，所以对飞船的位置的估计为： <span class="math display">\[ \int_0^T f(t)g(T-t)dt \]</span> 这就是连续的卷积，也就是将信号 <span class="math inline">\(f(t)\)</span> 和翻转平移后的信号 <span class="math inline">\(g(t)\)</span> 进行积分。在卷积神经网络中，卷积的第一个参数 <span class="math inline">\(f\)</span> 通常叫做输入，第二个参数 <span class="math inline">\(g\)</span> 通常叫做核函数，输出有时候叫特征映射。</p><h3 id="计算离散卷积">计算离散卷积</h3><p>计算离散卷积 <span class="math inline">\(f[n]*g[n]\)</span> 一般有三种方法：</p><ol type="1"><li>直接计算</li><li>快速傅里叶变换</li><li>分段卷积</li></ol><p>第一种方法就是直接根据定义来计算，第二种和第三种方法则都用到了快速傅里叶变换的知识，第三种方法是先将信号分成一小段一小段再以第二种方法来计算，时间复杂度会小一点，这里就只介绍第二种方法。三种方法的时间复杂度可以参考<a href="https://zh.wikipedia.org/wiki/%E5%8D%B7%E7%A7%AF" target="_blank" rel="noopener">维基百科</a>。</p><h4 id="快速傅里叶变换">快速傅里叶变换</h4><blockquote><p>两个离散信号在时域(time domain)做卷积相当于这两个信号在频域(frequence domain)相乘。</p></blockquote><p><span class="math display">\[ y[t]=f[t]*g[t]\leftrightarrow Y[f]=F[f]G[f] \]</span></p><p>根据定义不难证明以上公式，由于乘法比较简单，因此在计算卷积的时候先将信号从时域转成频域，然后计算 <span class="math inline">\(Y[f]\)</span> ，在将计算结果用傅里叶变换的逆变换转回时域。</p><h2 id="滤波器">滤波器</h2><p>卷积运算通常用于图像处理领域中的滤波操作，首先先来看看数字图像处理领域的女神 Lena。由于这张图包含了各种细节、平滑区域、阴影和纹理，因此广泛用于图像处理。</p><p>这是一张 400*400 三通道的图片，为了更方便演示算法，我们通常在灰度图上进行操作（Matlab 中可以使用 <code>rgb2gray()</code> 函数获取图像的灰度值）。那么如何把灰度图和波联系起来呢？我们取灰度图的<strong>第一行</strong>像素，然后根据灰度值画出曲线就能得到波：</p><p><img src="/2018/11/20/convolution-and-filters/lena.png"></p><blockquote><p>图像的频率反映了图像的像素灰度在空间中变化的情况，是灰度在平面空间上的梯度。</p></blockquote><p>图中曲线波动较大代表灰度图明暗差距大的地方，即高频成分较强，低频成分较弱；而波动较小代表灰度图明暗差距较小的地方，即低频成分较强，高频成分较弱。</p><p>这段话虽然能理解，但是学了傅里叶变换之后感觉懵懵的，总是觉得这一整个波不就是由同样的正弦波组成的吗？后来才醒悟过来，所谓的高频低频是相对的。先举个例子两张图片，一面墙壁的图像和国际象棋棋盘，前者灰度值分布平坦，其低频成分就较强，而高频成分较弱；而后者具有快速空间变化的图像来说，其高频成分会相对较强，低频则较弱。那么在一张图片中怎么理解呢？那就是将需要比较的两个地方分别截取出来，然后进行周期性延拓，因此波动较大的地方截取出来周期性延拓，进行傅里叶变换后，得到一系列正弦波，高频的正弦波就比较强（相比较于时域比较平坦的区域）。</p><p>滤波器根据滤波的目的可以分为两种，通过低频的滤波器称为低通滤波器，通过高频的滤波器称为高通滤波器。实现滤波的方式也分为两种，空间滤波和频域滤波。</p><h3 id="空间滤波器">空间滤波器</h3><p>空间滤波器指对图像一个邻域内的像素执行<strong>预定义的操作</strong>，滤波产生一个新像素，它的坐标等于邻域中心的坐标，滤波器的中心访问图像的每一个像素后就生成了滤波后的图像。通常会将滤波的结果存在新的图像中，避免改变图像内容的同时进行滤波操作。通常使用奇数尺寸 <span class="math inline">\(3\times 3\)</span> 的滤波器，对一张 <span class="math inline">\(4\times 4\)</span>的图像进行滤波，第一行第一个像素和第三行第二个像素的滤波过程如下图所示：</p><p><img src="/2018/11/20/convolution-and-filters/a.png"></p><p>图像边界的像素点没有那么多邻域，通常需要零填充（如下图所示）或者其他操作，然后对中间的像素进行滤波操作。</p><p><img src="/2018/11/20/convolution-and-filters/b.png"></p><p>根据上面提到的预定义的操作，空间滤波分为线性空间滤波和非线性空间滤波。非线性空间滤波例如统计排序滤波器（中值、最大值和最小值）和自适应滤波器等等。举个例子，最大值滤波器就是输出邻域内的像素的灰度值的最大值，如下图所示：</p><p><img src="/2018/11/20/convolution-and-filters/c.png"></p><p><span class="math inline">\(7=max(4, 7, 7, 2, 2, 5, 2, 4, 3)\)</span>，就是说新的图像的灰度值为原图像邻域内像素的灰度值的最大值。线性空间滤波器有一个和邻域对应的滤波器系数矩阵 <span class="math inline">\(\omega\)</span>，在滤波过程中，每个邻域内的像素的灰度值分别与对应位置的系数相乘，最后再相加，如下图所示：</p><p><img src="/2018/11/20/convolution-and-filters/d.png"></p><p>对于图像 <span class="math inline">\(f\)</span> 中任意一点 <span class="math inline">\((x, y)\)</span>，滤波器的响应 <span class="math inline">\(g(x, y)\)</span> 是滤波器系数与该滤波器所包围的像素的灰度值的乘积之和： <span class="math display">\[ g(x, y)=\omega(-1, -1)f(x-1, y-1)+\omega(-1, 0)f(x-1, y)...\omega(1, 1)f(x+1, y+1) \]</span> 对于奇数尺寸 <span class="math inline">\((2a+1)\times (2b+1)\)</span> 的滤波器，有： <span class="math display">\[ g(x, y)=\sum_{s=-a}^a\sum_{t=-b}^b\omega(s, t)f(x+s, y+t) \]</span> 这个操作叫做<strong>相关</strong>，有点类似于二维卷积操作，不过卷积需要滤波器翻转： <span class="math display">\[ \omega(x, y)*f(x, y)=\sum_{s=-a}^a\sum_{t=-b}^b\omega(s, t)f(x-s, y-t) \]</span> 所以如果滤波器是对称的，那么相关和卷积将得到相同的结果，我们将翻转后的滤波器系数和图像进行卷积即可实现线性空间滤波操作。</p><h4 id="边缘提取">边缘提取</h4><p>大四选修数字图像处理的实验三就要求实现四种（Sobel 算子、Prewitt 算子、Roberts 算子和 Marr 算子）边缘提取函数（空间高通滤波），代码也都托管在 <a href="https://github.com/pengzhendong/MatlabDIP/tree/master/lab2" target="_blank" rel="noopener">Github</a>。不同的边缘提取函数的区别就是算子的不同，即滤波器系数矩阵不同，这里只详细介绍一下 Sobel 算子：</p><p><img src="/2018/11/20/convolution-and-filters/sobel.png"></p><p>用这两个算子与原图像做卷积运算可以分别得到纵向和横向灰度值的梯度（即变化率），像素两边的灰度值差距越大，卷积的结果的绝对值也就越大，因此可以得到图像的边缘：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[img, map] = imread(<span class="string">'Lena.jpg'</span>);</span><br><span class="line">img = rgb2gray(img);</span><br><span class="line"></span><br><span class="line">subplot(<span class="number">131</span>), imshow(img);</span><br><span class="line"></span><br><span class="line">hx = [<span class="number">-1</span> <span class="number">-2</span> <span class="number">-1</span>; <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>; <span class="number">1</span> <span class="number">2</span> <span class="number">1</span>];</span><br><span class="line">hy = hx';</span><br><span class="line">Gx = conv2(im2double(img), hx);</span><br><span class="line">Gy = conv2(im2double(img), hy);</span><br><span class="line">sobel = <span class="built_in">abs</span>(Gx) + <span class="built_in">abs</span>(Gy);</span><br><span class="line">subplot(<span class="number">132</span>), imshow(sobel);</span><br><span class="line"></span><br><span class="line">threshold = <span class="built_in">max</span>(<span class="built_in">max</span>(sobel)) * <span class="number">0.18</span>;</span><br><span class="line">sobel(sobel &gt;= threshold) = <span class="number">1</span>;</span><br><span class="line">sobel(sobel &lt; threshold) = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">subplot(<span class="number">133</span>), imshow(sobel);</span><br></pre></td></tr></table></figure><p>得到横向和纵向的梯度后，使用以下公式计算灰度的大小（注意是矩阵元素的平方 <code>sqrt(Gx.^2+Gy.^2)</code>）： <span class="math display">\[ G=\sqrt{G_x^2+G_y^2} \]</span> 但是为了提高运算效率，通常使用不开方的近似值，即使会损失一定的精度： <span class="math display">\[ |G|=|G_x|+|G_y| \]</span> 最后可以进行阈值处理，将灰度图变成二值图像，让检测的边缘更加明显。其他的算子如下所示：</p><ul><li>Roberts 算子：<code>hx = [-1 -1 -1; 0 0 0; 1 1 1]; hy = hx';</code></li><li>Prewitt 算子：<code>hx = [-1 0; 0 1]; hy = [0 -1; 1 0];</code></li><li>...</li></ul><h3 id="频域滤波器">频域滤波器</h3><p>实验二要求实现三种（理想、布特沃斯和高斯滤波）低通滤波器和高通滤波器，由于时域上的卷积操作等于频域上的乘积操作，因此线性空间滤波和频域滤波一一对应，但是频域滤波不能进行非线性滤波。</p><h4 id="频谱图">频谱图</h4><p>傅里叶变换可以将信号从时域变换成频域，在数字图行处理中时域体现为空间上的分布，因此傅里叶变换可以将图像的灰度分布函数变成图像的频率分布函数。在做傅里叶变换的时候相当于是先将图片做周期性延拓，然后再进行傅里叶变换，通常我们只取一个周期分析，越亮表示该频率的幅值越大。</p><p>由于图像是一个<strong>实数</strong>信号，可以在数学上严格证明，它的傅里叶变换后的频域信号关于 0 频轴对称。所以频谱图中四个角为低频，中间为高频，而且低频幅值较大。为了便于频域的滤波和频谱的分析，常常在变换之前进行频谱的中心化。离中心越近，频率越低，离中心越远，频率越高，类似于二维的坐标轴。</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[img, map] = imread(<span class="string">'Lena.jpg'</span>);</span><br><span class="line">img = rgb2gray(img);</span><br><span class="line">subplot(<span class="number">131</span>), imshow(img);</span><br><span class="line">subplot(<span class="number">132</span>), f = fft2(img), imshow(<span class="built_in">log</span>(<span class="number">1</span>+<span class="built_in">abs</span>(f)), []);</span><br><span class="line">subplot(<span class="number">133</span>), f = fftshift(f), imshow(<span class="built_in">log</span>(<span class="number">1</span>+<span class="built_in">abs</span>(f)), []);</span><br></pre></td></tr></table></figure><p>由于幅度值范围很大，所以在显示频谱图之前要取对数处理；<code>imshow(I,[])</code>对取对数后的值进行归一化，自动拉伸动态范围，增大对比度； <code>fftshift()</code> 将低频调整到中间，高频在外围。</p><h4 id="理想低通滤波器">理想低通滤波器</h4><p>这里就只在详细介绍理想低通滤波器，它由下面的函数确定： <span class="math display">\[ \begin{align*} H(u, v)=\begin{cases} 1 &amp; D(u, v) \leq D_0 \\\ 0 &amp; D(u, v) &gt; D_0 \end{cases} \end{align*} \]</span> 其中 <span class="math inline">\(D_0\)</span> 是正常数，<span class="math inline">\(D(u, v)\)</span> 是频域中的点 <span class="math inline">\((u, v)\)</span> 和中心的距离，即 <span class="math display">\[ D(u, v)=\sqrt{(u-P/2)^2+(v-Q/2)^2} \]</span> <span class="math inline">\(P, Q\)</span> 是频域图的尺寸。“理想”的意思是在以 0 频率为中心，半径为 <span class="math inline">\(D_0\)</span> 的圆内，所有频率无衰减地通过，圆外地所有频率则被完全过滤。滤波代码和效果如下所示：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[img, map] = imread(<span class="string">'Lena.jpg'</span>);</span><br><span class="line">img = rgb2gray(img);</span><br><span class="line">D0 = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">subplot(<span class="number">221</span>), imshow(img);</span><br><span class="line">subplot(<span class="number">222</span>), f = fftshift(fft2(img)), imshow(<span class="number">1</span>+<span class="built_in">log</span>(<span class="built_in">abs</span>(f)), []);</span><br><span class="line"></span><br><span class="line">[P, Q] = <span class="built_in">size</span>(f);</span><br><span class="line">H = <span class="built_in">zeros</span>(P, Q);</span><br><span class="line"><span class="keyword">for</span> u = <span class="number">1</span>:P</span><br><span class="line">    <span class="keyword">for</span> v = <span class="number">1</span>:Q</span><br><span class="line">        D = <span class="built_in">sqrt</span>((u - <span class="built_in">round</span>(P/<span class="number">2</span>))^<span class="number">2</span> + (v - <span class="built_in">round</span>(Q/<span class="number">2</span>))^<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> D &lt;= D0</span><br><span class="line">            H(u, v) = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            H(u, v) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">f = f .* H;</span><br><span class="line"></span><br><span class="line">img = uint8(<span class="built_in">real</span>(ifft2(ifftshift(f))));</span><br><span class="line">subplot(<span class="number">223</span>), imshow(img);</span><br><span class="line">subplot(<span class="number">224</span>), f = fftshift(fft2(img)), imshow(<span class="built_in">log</span>(<span class="built_in">abs</span>(f)), []);</span><br><span class="line"></span><br><span class="line"><span class="built_in">figure</span>, surf(<span class="number">1</span>:P, <span class="number">1</span>:Q, H);</span><br><span class="line">axis([<span class="number">1</span> m <span class="number">1</span> n <span class="number">0</span> <span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>对于一幅图像来说，低频就是边缘以内的内容，也就是图像的大部分信息，即图像的大致概貌和轮廓，是图像的近似信息。高频指图像边缘的灰度值变化快，图像的细节处也是属于灰度值急剧变化的区域，正是因为灰度值的急剧变化，才会出现细节。另外噪点也是因为像素点灰度值明显不一样了，即高频部分，因此噪声在高频。因此低通滤波器可以去噪，高通滤波器可以去模糊，各种滤波器对应的公式如下所示，n 阶布特沃斯滤波器的阶数趋于正无穷时，就是理想滤波器，对频率的截止也就会更加尖锐。</p><table><colgroup><col style="width:26%"><col style="width:73%"></colgroup><thead><tr class="header"><th>滤波器</th><th>函数</th></tr></thead><tbody><tr class="odd"><td>理想低通滤波器</td><td><span class="math inline">\(\begin{equation}H(u, v)=\begin{cases}1 &amp; D(u, v) \leq D_0 \\\ 0 &amp; D(u, v) &gt; D_0\end{cases}\end{equation}\)</span></td></tr><tr class="even"><td>n 阶布特沃斯低通滤波器</td><td><span class="math inline">\(H(u,v)=\frac{1}{1+\Big[D(u, v)/D_0\Big]^{2n}}\)</span></td></tr><tr class="odd"><td>高斯低通滤波器</td><td><span class="math inline">\(H(u, v)=e^{-D^2(u, v)/2D_0^2}\)</span></td></tr><tr class="even"><td>理想高通滤波器</td><td><span class="math inline">\(\begin{equation}H(u, v)=\begin{cases}0 &amp; D(u, v) \leq D_0 \\\ 1 &amp; D(u, v) &gt; D_0\end{cases}\end{equation}\)</span></td></tr><tr class="odd"><td>n 阶布特沃斯高通滤波器</td><td><span class="math inline">\(H(u,v)=\frac{1}{1+\Big[D_0/D(u, v)\Big]^{2n}}\)</span></td></tr><tr class="even"><td>高斯高通滤波器</td><td><span class="math inline">\(H(u, v)=1-e^{-D^2(u, v)/2D_0^2}\)</span></td></tr></tbody></table><h2 id="参考文献">参考文献</h2><ol type="1"><li>ViatorSun. 图像傅里叶变换的频谱图. https://blog.csdn.net/ViatorSun/article/details/82387854</li><li>冈萨雷斯. 数字图像处理</li></ol></div><div class="reward-container"><div>疏影横斜水清浅，暗香浮动月黄昏</div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.png" alt="Randy Peng 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="/images/alipay.png" alt="Randy Peng 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Randy Peng</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://pengzhendong.cn/2018/11/20/convolution-and-filters/" title="卷积与滤波器">https://pengzhendong.cn/2018/11/20/convolution-and-filters/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><center><br><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5aa9d6309315fb5e" async="async"></script></div></center><footer class="post-footer"><div class="post-tags"> <a href="/tags/Deep-Learning/" rel="tag"># Deep Learning</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2018/11/15/trigger-word-detection/" rel="prev" title="触发词检测"><i class="fa fa-chevron-left"></i> 触发词检测</a></div><div class="post-nav-item"> <a href="/2018/11/26/beam-search-and-bleu/" rel="next" title="集束搜索和 BLEU">集束搜索和 BLEU<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#卷积运算"><span class="nav-number">2.</span> <span class="nav-text">卷积运算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义"><span class="nav-number">2.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算离散卷积"><span class="nav-number">2.2.</span> <span class="nav-text">计算离散卷积</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#快速傅里叶变换"><span class="nav-number">2.2.1.</span> <span class="nav-text">快速傅里叶变换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#滤波器"><span class="nav-number">3.</span> <span class="nav-text">滤波器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#空间滤波器"><span class="nav-number">3.1.</span> <span class="nav-text">空间滤波器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#边缘提取"><span class="nav-number">3.1.1.</span> <span class="nav-text">边缘提取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#频域滤波器"><span class="nav-number">3.2.</span> <span class="nav-text">频域滤波器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#频谱图"><span class="nav-number">3.2.1.</span> <span class="nav-text">频谱图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#理想低通滤波器"><span class="nav-number">3.2.2.</span> <span class="nav-text">理想低通滤波器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文献"><span class="nav-number">4.</span> <span class="nav-text">参考文献</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Randy Peng" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">Randy Peng</p><div class="site-description" itemprop="description">路漫漫其修远兮 吾将上下而求索</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/pengzhendong" title="GitHub → https://github.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/pengzhendong" title="Twitter → https://twitter.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i> Twitter</a></span><span class="links-of-author-item"><a href="mailto:275331498@qq.com" title="E-Mail → mailto:275331498@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.facebook.com/pengzhendong" title="FaceBook → https://www.facebook.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i> FaceBook</a></span><span class="links-of-author-item"><a href="https://t.me/pengzhendong" title="Telegram → https://t.me/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-telegram fa-fw"></i> Telegram</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/pengzhendong" title="知乎 → https://www.zhihu.com/people/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-leanpub fa-fw"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://weibo.com/qq275331498" title="微博 → https://weibo.com/qq275331498" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i> 微博</a></span><span class="links-of-author-item"><a href="/about" target="_self" title="关于 → /about" target="_self"><i class="fa fa-user fa-fw"></i> 关于</a></span></div><hr style="margin-top:20px;margin-bottom:20px"> <img src="/images/wechat.png"></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Randy Peng</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span title="站点总字数">258k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">3:55</span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"YHMwvrTgcfDjOXmiGY3jQ2r5-gzGzoHsz","app_key":"JRfKfM8mRPgxMB9GOSAnix9W","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/algolia-search.js"></script><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script></body></html>