<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"pengzhendong.cn",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"39IHYBUVGR",apiKey:"4287c8f8a629343c8d2212e108417ceb",indexName:"Notes",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="å‰è¨€ å†™è®ºæ–‡åšå®éªŒçš„æ—¶å€™æ›¾ç»æƒ³è¿‡ç”¨æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ï¼Œæ— å¥ˆæ ·æœ¬å¤ªä¸å‡è¡¡ï¼Œæ‰€ä»¥æœ€åç”¨äº†è‡ªç¼–ç å™¨æå–ç‰¹å¾ã€‚åœ¨ Coursera çš„ä½œä¸šä¸­ï¼Œè¯¥å®éªŒåˆ†ä¸ºä¸¤ä¸ªå°å®éªŒï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ–‡æœ¬åˆ†ç±»ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ LSTM RNN è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€‚"><meta name="keywords" content="Deep Learning"><meta property="og:type" content="article"><meta property="og:title" content="Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ"><meta property="og:url" content="https://pengzhendong.cn/2018/08/31/emojify/index.html"><meta property="og:site_name" content="Randy&#39;s Notes"><meta property="og:description" content="å‰è¨€ å†™è®ºæ–‡åšå®éªŒçš„æ—¶å€™æ›¾ç»æƒ³è¿‡ç”¨æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ï¼Œæ— å¥ˆæ ·æœ¬å¤ªä¸å‡è¡¡ï¼Œæ‰€ä»¥æœ€åç”¨äº†è‡ªç¼–ç å™¨æå–ç‰¹å¾ã€‚åœ¨ Coursera çš„ä½œä¸šä¸­ï¼Œè¯¥å®éªŒåˆ†ä¸ºä¸¤ä¸ªå°å®éªŒï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ–‡æœ¬åˆ†ç±»ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ LSTM RNN è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€‚"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://pengzhendong.cn/2018/08/31/emojify/data_set.png"><meta property="og:image" content="https://pengzhendong.cn/2018/08/31/emojify/emo_model.png"><meta property="og:image" content="https://pengzhendong.cn/2018/08/31/emojify/output.png"><meta property="og:image" content="https://pengzhendong.cn/2018/08/31/emojify/emojifier-v2.png"><meta property="og:updated_time" content="2018-08-31T04:18:57.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ"><meta name="twitter:description" content="å‰è¨€ å†™è®ºæ–‡åšå®éªŒçš„æ—¶å€™æ›¾ç»æƒ³è¿‡ç”¨æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ï¼Œæ— å¥ˆæ ·æœ¬å¤ªä¸å‡è¡¡ï¼Œæ‰€ä»¥æœ€åç”¨äº†è‡ªç¼–ç å™¨æå–ç‰¹å¾ã€‚åœ¨ Coursera çš„ä½œä¸šä¸­ï¼Œè¯¥å®éªŒåˆ†ä¸ºä¸¤ä¸ªå°å®éªŒï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ–‡æœ¬åˆ†ç±»ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ LSTM RNN è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€‚"><meta name="twitter:image" content="https://pengzhendong.cn/2018/08/31/emojify/data_set.png"><link rel="canonical" href="https://pengzhendong.cn/2018/08/31/emojify/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><style type="text/css">body{background-image:url(/images/rockywall.png)}</style><title>Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ | Randy's Notes</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92548519-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-92548519-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?06c54470f22c395ef480d6fb358497d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Randy's Notes</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> å½’æ¡£</a></li><li class="menu-item menu-item-å‹é“¾"><a href="/friends/" rel="section"><i class="fa fa-users fa-fw"></i> å‹é“¾</a></li><li class="menu-item menu-item-ä¹¦å•"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i> ä¹¦å•</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> æœç´¢</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/pengzhendong" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pengzhendong.cn/2018/08/31/emojify/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Randy Peng"><meta itemprop="description" content="è·¯æ¼«æ¼«å…¶ä¿®è¿œå…® å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Randy's Notes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2018-08-31 10:18:33 / ä¿®æ”¹æ—¶é—´ï¼š12:18:57" itemprop="dateCreated datePublished" datetime="2018-08-31T10:18:33+08:00">2018-08-31</time></span><span id="/2018/08/31/emojify/" class="post-meta-item leancloud_visitors" data-flag-title="Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ" title="é˜…è¯»æ¬¡æ•°"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span><span class="leancloud-visitors-count"></span></span><br><span class="post-meta-item" title="æœ¬æ–‡å­—æ•°"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span> <span>0</span></span><span class="post-meta-item" title="é˜…è¯»æ—¶é•¿"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span> <span>1 åˆ†é’Ÿ</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€">å‰è¨€</h2><p>å†™è®ºæ–‡åšå®éªŒçš„æ—¶å€™æ›¾ç»æƒ³è¿‡ç”¨æ–‡æœ¬åˆ†ç±»çš„æ¨¡å‹ï¼Œæ— å¥ˆæ ·æœ¬å¤ªä¸å‡è¡¡ï¼Œæ‰€ä»¥æœ€åç”¨äº†è‡ªç¼–ç å™¨æå–ç‰¹å¾ã€‚åœ¨ Coursera çš„ä½œä¸šä¸­ï¼Œè¯¥å®éªŒåˆ†ä¸ºä¸¤ä¸ªå°å®éªŒï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ–‡æœ¬åˆ†ç±»ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ LSTM RNN è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€‚</p><a id="more"></a><h2 id="baseline-æ¨¡å‹-emojifier-v1">Baseline æ¨¡å‹: Emojifier-V1</h2><p>è®­ç»ƒé›† X ä¸­åŒ…å« 127 ä¸ªå¥å­ï¼Œå…¶æ ‡ç­¾ä¸º 0 åˆ° 4 åˆ†åˆ«å¯¹åº”ä¸€ä¸ª emoji è¡¨æƒ…ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/08/31/emojify/data_set.png"></p><p>ç°åœ¨è½½å…¥æ•°æ®é›†ï¼Œå¹¶ä¸”æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">X_train, Y_train = read_csv(<span class="string">'data/train_emoji.csv'</span>)</span><br><span class="line">X_test, Y_test = read_csv(<span class="string">'data/tesss.csv'</span>)</span><br><span class="line">maxLen = len(max(X_train, key=len).split())</span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">print(X_train[index], label_to_emoji(Y_train[index]))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I am proud of your achievements ğŸ˜„</span><br></pre></td></tr></table></figure><h3 id="emojifier-v1-æ¦‚å†µ">Emojifier-V1 æ¦‚å†µ</h3><p>Emojifier-V1 çš„æ¦‚å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/08/31/emojify/emo_model.png"></p><p>è¯¥æ¨¡å‹æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆå»è®­ç»ƒå¥½çš„ Embedding ä¸­æ‰¾åˆ°æ¯ä¸ªå•è¯çš„åµŒå…¥ï¼Œç„¶åå¯¹å¥å­ä¸­æ‰€æœ‰å•è¯çš„åµŒå…¥æ±‚å¹³å‡ï¼Œå°†å…¶ä½œä¸ºè¾“å…¥ï¼Œè¾“å…¥åˆ°ä¸€ä¸ªå¤šåˆ†ç±»çš„å…¨è¿æ¥ç½‘ç»œä¸­ï¼Œæœ€åé¢„æµ‹å¥å­çš„æƒ…æ„Ÿã€‚</p><h3 id="å®ç°-emojifier-v1">å®ç° Emojifier-V1</h3><p>æ­¤å¤„ä¸å†ç»†è¿°å¤šåˆ†ç±»çš„è¿‡ç¨‹ï¼Œæ¨¡å‹çš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š <span class="math display">\[ z^{(i)} = W \times avg^{(i)} + b \]</span></p><p><span class="math display">\[ a^{(i)} = softmax(z^{(i)}) \]</span></p><p><span class="math display">\[ \mathcal{L}^{(i)} = - \sum_{k = 0}^{n_y - 1} Yoh^{(i)}_k * log(a^{(i)}_k) \]</span></p><p>å…¶ä¸­ <span class="math inline">\(Yoh\)</span> (Y one hot) æ˜¯è¾“å‡ºçš„ç‹¬çƒ­ç¼–ç ã€‚æœ€åæ¨¡å‹åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡èƒ½å¤Ÿè¾¾åˆ° 97% å’Œ 86% ï¼ŒåŒæ—¶å¯¹äºä¸€äº›åœ¨è®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°è¿‡çš„å•è¯ (ä¾‹å¦‚: adore) ä¹Ÿèƒ½å¾—åˆ°ä¸é”™çš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X_my_sentences = np.array([<span class="string">"i adore you"</span>, <span class="string">"i love you"</span>, <span class="string">"funny lol"</span>, <span class="string">"lets play with a ball"</span>, <span class="string">"food is ready"</span>, <span class="string">"you are not happy"</span>])</span><br><span class="line">Y_my_labels = np.array([[<span class="number">0</span>], [<span class="number">0</span>], [<span class="number">2</span>], [<span class="number">1</span>], [<span class="number">4</span>],[<span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line">pred = predict(X_my_sentences, Y_my_labels , W, b, word_to_vec_map)</span><br><span class="line">print_predictions(X_my_sentences, pred)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Accuracy: 0.8333333333333334</span><br><span class="line"></span><br><span class="line">i adore you â¤ï¸</span><br><span class="line">i love you â¤ï¸</span><br><span class="line">funny lol ğŸ˜„</span><br><span class="line">lets play with a ball âš¾</span><br><span class="line">food is ready ğŸ´</span><br><span class="line">you are not happy â¤ï¸</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¯¥æ¨¡å‹å¹¶ä¸èƒ½åˆ†æ not happy æ˜¯è¡¨ç¤ºä¸å¼€å¿ƒï¼Œè€Œåªæ˜¯ç®€å•åœ°å­¦ä¹ äº† happy è¿™ä¸ªå•è¯ã€‚è¾“å‡ºæ¨¡å‹çš„æ··æ·†çŸ©é˜µçœ‹ä¸€ä¸‹æ¨¡å‹çš„è¡¨ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(Y_test.shape)</span><br><span class="line">print(<span class="string">'           '</span>+ label_to_emoji(<span class="number">0</span>)+ <span class="string">'    '</span> + label_to_emoji(<span class="number">1</span>) + <span class="string">'    '</span> +  label_to_emoji(<span class="number">2</span>)+ <span class="string">'    '</span> + label_to_emoji(<span class="number">3</span>)+<span class="string">'   '</span> + label_to_emoji(<span class="number">4</span>))</span><br><span class="line">print(pd.crosstab(Y_test, pred_test.reshape(<span class="number">56</span>,), rownames=[<span class="string">'Actual'</span>], colnames=[<span class="string">'Predicted'</span>], margins=<span class="literal">True</span>))</span><br><span class="line">plot_confusion_matrix(Y_test, pred_test)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(56,)</span><br><span class="line">           â¤ï¸   âš¾   ğŸ˜„   ğŸ˜  ğŸ´</span><br><span class="line">Predicted  0.0  1.0  2.0  3.0  4.0  All</span><br><span class="line">Actual                                 </span><br><span class="line">0            6    0    0    1    0    7</span><br><span class="line">1            0    8    0    0    0    8</span><br><span class="line">2            2    0   16    0    0   18</span><br><span class="line">3            1    1    2   12    0   16</span><br><span class="line">4            0    0    1    0    6    7</span><br><span class="line">All          9    9   19   13    6   56</span><br></pre></td></tr></table></figure><p><img src="/2018/08/31/emojify/output.png"></p><p>çŸ©é˜µå¯¹è§’çº¿ä¸Šçš„é¢œè‰²æ¯”è¾ƒæ·±ï¼Œè¡¨ç¤ºæ¨¡å‹çš„è¡¨ç°è¿˜ä¸é”™ã€‚ä½†æ˜¯æ¨¡å‹å´æ— æ³•åˆ†æ not xxx è¿™ç±»çš„çŸ­è¯­ï¼Œå› ä¸ºåµŒå…¥çŸ©é˜µä¸­æ²¡æœ‰å¯¹åº”çš„è¡¨ç¤ºï¼Œè€Œä¸”å•çº¯åœ°å¯¹æ‰€æœ‰å•è¯çš„åµŒå…¥æ±‚å¹³å‡ä¼šä¸¢å¤±è¾“å…¥çš„å•è¯çš„é¡ºåºï¼Œå› æ­¤éœ€è¦æ›´å¥½çš„ç®—æ³•ã€‚</p><h2 id="emojifier-v2-åœ¨-keras-ä¸­ä½¿ç”¨-lstms">Emojifier-V2: åœ¨ Keras ä¸­ä½¿ç”¨ LSTMs</h2><p>Emojifier-V2 çš„æ¦‚å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/2018/08/31/emojify/emojifier-v2.png"></p><p>è¿™æ˜¯ä¸€ä¸ªä¸¤å±‚çš„ LSTM åºåˆ—åˆ†ç±»å™¨ã€‚è¿™æ¬¡å®éªŒä½¿ç”¨ mini-batches æ¥è®­ç»ƒ Kerasï¼Œå› æ­¤ä¸€ä¸ª batch ä¸­çš„åºåˆ—çš„é•¿åº¦åº”è¯¥ç›¸åŒï¼Œå› æ­¤éœ€è¦è¡¥ 0ã€‚ä¾‹å¦‚ä¸€ä¸ª batch ä¸­çš„åºåˆ—çš„æœ€å¤§é•¿åº¦ä¸º 5ï¼Œé‚£ä¹ˆ "I love you" è¿™ä¸ªå¥å­çš„è¡¨ç¤ºä¸º <span class="math inline">\((e_{i}, e_{love}, e_{you}, \vec{0}, \vec{0})\)</span>ã€‚</p><h3 id="embedding-å±‚">Embedding å±‚</h3><p>åœ¨ Keras ä¸­ï¼ŒåµŒå…¥çŸ©é˜µè¢«è¡¨ç¤ºæˆä¸€ä¸ªå±‚ï¼Œç„¶åå°†è¯çš„ç´¢å¼•åŒ¹é…æˆåµŒå…¥å‘é‡ã€‚åµŒå…¥çŸ©é˜µå¯ä»¥è¢«è®­ç»ƒå‡ºæ¥ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªè®­ç»ƒå¥½çš„çŸ©é˜µæ¥åˆå§‹åŒ–å®ƒã€‚<code>Embedding()</code> å±‚è¾“å‡ºæ˜¯ä¸€ä¸ª (batch size, max input length, dimension of word vectors) çš„çŸ©é˜µã€‚word_to_index çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sentences_to_indices</span><span class="params">(X, word_to_index, max_len)</span>:</span></span><br><span class="line">    m = X.shape[<span class="number">0</span>]                                   <span class="comment"># number of training examples</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Initialize X_indices as a numpy matrix of zeros and the correct shape</span></span><br><span class="line">    X_indices = np.zeros((m, max_len))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(m):                               <span class="comment"># loop over training examples</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Convert the ith training sentence in lower case and split is into words. You should get a list of words.</span></span><br><span class="line">        sentence_words = X[i].lower().split()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Initialize j to 0</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Loop over the words of sentence_words</span></span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> sentence_words:</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Set the (i,j)th entry of X_indices to the index of the correct word.</span></span><br><span class="line">            X_indices[i, j] = word_to_index[w]</span><br><span class="line">            <span class="comment"># Increment j to j + 1</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> X_indices</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦å®ç°é¢„è®­ç»ƒçš„ Embedding å±‚ï¼Œå°†è®­ç»ƒå¥½çš„åµŒå…¥çŸ©é˜µè®¾ç½®åˆ° <code>Embedding()</code> å±‚çš„æƒå€¼ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretrained_embedding_layer</span><span class="params">(word_to_vec_map, word_to_index)</span>:</span></span><br><span class="line">    vocab_len = len(word_to_index) + <span class="number">1</span>                  <span class="comment"># adding 1 to fit Keras embedding (requirement)</span></span><br><span class="line">    emb_dim = word_to_vec_map[<span class="string">"cucumber"</span>].shape[<span class="number">0</span>]      <span class="comment"># define dimensionality of your GloVe word vectors (= 50)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Initialize the embedding matrix as a numpy array of zeros of shape (vocab_len, dimensions of word vectors = emb_dim)</span></span><br><span class="line">    emb_matrix = np.zeros((vocab_len, emb_dim))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Set each row "index" of the embedding matrix to be the word vector representation of the "index"th word of the vocabulary</span></span><br><span class="line">    <span class="keyword">for</span> word, index <span class="keyword">in</span> word_to_index.items():</span><br><span class="line">        emb_matrix[index, :] = word_to_vec_map[word]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Define Keras embedding layer with the correct output/input sizes, make it trainable.</span></span><br><span class="line">    <span class="comment"># Use Embedding(...). Make sure to set trainable=False.</span></span><br><span class="line">    embedding_layer = Embedding(vocab_len, emb_dim, trainable = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Build the embedding layer, it is required before setting the weights of the embedding layer. Do not modify the "None".</span></span><br><span class="line">    embedding_layer.build((<span class="literal">None</span>,))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Set the weights of the embedding layer to the embedding matrix. Your layer is now pretrained.</span></span><br><span class="line">    embedding_layer.set_weights([emb_matrix])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> embedding_layer</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºæ¨¡å‹">æ„å»ºæ¨¡å‹</h3><p>æ¥ä¸‹æ¥éœ€è¦æ„å»ºæ¨¡å‹ï¼Œæ¨¡å‹åˆ†ä¸ºï¼š</p><ul><li>è¾“å…¥å±‚: <code>Input((max_len, m), dtype='int32')</code></li><li>LSTM å±‚: <code>LSTM(hidden_units, return_sequence)(embeddings)</code></li><li>Dropout å±‚: <code>Dropout(keep_prob)(X)</code></li><li>å…¨è¿æ¥å±‚: <code>Dense(output_dimension)(X)</code></li><li>æ¿€æ´»å±‚: <code>Activation(activation_func)(X)</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Emojify_V2</span><span class="params">(input_shape, word_to_vec_map, word_to_index)</span>:</span></span><br><span class="line">    <span class="comment"># Define sentence_indices as the input of the graph, it should be of shape input_shape and dtype 'int32' (as it contains indices).</span></span><br><span class="line">    sentence_indices = Input(input_shape, dtype=<span class="string">'int32'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create the embedding layer pretrained with GloVe Vectors (â‰ˆ1 line)</span></span><br><span class="line">    embedding_layer = pretrained_embedding_layer(word_to_vec_map, word_to_index)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Propagate sentence_indices through your embedding layer, you get back the embeddings</span></span><br><span class="line">    embeddings = embedding_layer(sentence_indices)   </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Propagate the embeddings through an LSTM layer with 128-dimensional hidden state</span></span><br><span class="line">    <span class="comment"># Be careful, the returned output should be a batch of sequences.</span></span><br><span class="line">    X = LSTM(<span class="number">128</span>, return_sequences=<span class="literal">True</span>)(embeddings)</span><br><span class="line">    <span class="comment"># Add dropout with a probability of 0.5</span></span><br><span class="line">    X = Dropout(<span class="number">0.5</span>)(X)</span><br><span class="line">    <span class="comment"># Propagate X trough another LSTM layer with 128-dimensional hidden state</span></span><br><span class="line">    <span class="comment"># Be careful, the returned output should be a single hidden state, not a batch of sequences.</span></span><br><span class="line">    X = LSTM(<span class="number">128</span>, return_sequences=<span class="literal">False</span>)(X)</span><br><span class="line">    <span class="comment"># Add dropout with a probability of 0.5</span></span><br><span class="line">    X = Dropout(<span class="number">0.5</span>)(X)</span><br><span class="line">    <span class="comment"># Propagate X through a Dense layer with softmax activation to get back a batch of 5-dimensional vectors.</span></span><br><span class="line">    X = Dense(<span class="number">5</span>)(X)</span><br><span class="line">    <span class="comment"># Add a softmax activation</span></span><br><span class="line">    X = Activation(<span class="string">'softmax'</span>)(X)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Create Model instance which converts sentence_indices into X.</span></span><br><span class="line">    model = Model(inputs=sentence_indices, outputs=X)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> model</span><br></pre></td></tr></table></figure><p>æ„å»ºå¥½æ¨¡å‹åå¯ä»¥é€šè¿‡æ¨¡å‹çš„ <code>summary()</code> æ–¹æ³•æ¥æ£€æŸ¥æ¨¡å‹çš„æ¦‚è¦ (max_len = 10)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = Emojify_V2((maxLen,), word_to_vec_map, word_to_index)</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">_________________________________________________________________</span><br><span class="line">Layer (type)                 Output Shape              Param #   </span><br><span class="line">=================================================================</span><br><span class="line">input_1 (InputLayer)         (None, 10)                0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">embedding_2 (Embedding)      (None, 10, 50)            20000050  </span><br><span class="line">_________________________________________________________________</span><br><span class="line">lstm_1 (LSTM)                (None, 10, 128)           91648     </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dropout_1 (Dropout)          (None, 10, 128)           0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">lstm_2 (LSTM)                (None, 128)               131584    </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dropout_2 (Dropout)          (None, 128)               0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dense_1 (Dense)              (None, 5)                 645       </span><br><span class="line">_________________________________________________________________</span><br><span class="line">activation_1 (Activation)    (None, 5)                 0         </span><br><span class="line">=================================================================</span><br><span class="line">Total params: 20,223,927</span><br><span class="line">Trainable params: 223,877</span><br><span class="line">Non-trainable params: 20,000,050</span><br><span class="line">_________________________________________________________________</span><br></pre></td></tr></table></figure><p>ç”±äºåµŒå…¥çŸ©é˜µæ˜¯è®­ç»ƒå¥½çš„ <code>trainable = False</code>ï¼Œå› æ­¤æœ‰ 400,001 * 50 = 20,000,050 ä¸ªå‚æ•°æ˜¯ Non-trainable å‚æ•°ã€‚æ¥ä¸‹æ¥éœ€è¦ç¼–è¯‘æ¨¡å‹ï¼Œå®šä¹‰æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨å’Œè¯„ä¼°æŒ‡æ ‡ï¼Œæœ€åæ‹Ÿåˆæ¨¡å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model.compile(loss=<span class="string">'categorical_crossentropy'</span>, optimizer=<span class="string">'adam'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line"></span><br><span class="line">X_train_indices = sentences_to_indices(X_train, word_to_index, maxLen)</span><br><span class="line">Y_train_oh = convert_to_one_hot(Y_train, C = <span class="number">5</span>)</span><br><span class="line">model.fit(X_train_indices, Y_train_oh, epochs = <span class="number">50</span>, batch_size = <span class="number">32</span>, shuffle=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡èƒ½æ¥è¿‘ 100% å’Œ 91%ã€‚å¯¹äº not happy ä¹Ÿèƒ½å‡†ç¡®é¢„æµ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x_test = np.array([<span class="string">'you are not happy'</span>])</span><br><span class="line">X_test_indices = sentences_to_indices(x_test, word_to_index, maxLen)</span><br><span class="line">print(x_test[<span class="number">0</span>] +<span class="string">' '</span>+  label_to_emoji(np.argmax(model.predict(X_test_indices))))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you are not happy ğŸ˜</span><br></pre></td></tr></table></figure><p>å› ä¸º LSTM ç½‘ç»œå…·æœ‰é•¿çŸ­æœŸè®°å¿†ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¾ˆå¥½åœ°é¢„æµ‹æŸäº›å•è¯çš„ç»„åˆã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>åœ¨ NLP ä»»åŠ¡ä¸­ï¼Œå¦‚æœè®­ç»ƒé›†æ¯”è¾ƒå°ï¼Œæ¯”è¾ƒé€‚åˆç›´æ¥ç”¨è®­ç»ƒå¥½çš„åµŒå…¥çŸ©é˜µè€Œä¸æ˜¯è‡ªå·±è®­ç»ƒä¸€ä¸ªã€‚åœ¨ RNN ä¸­ï¼Œå¦‚æœæƒ³ç”¨ mini-batches æé«˜æ•ˆç‡(çŸ©é˜µçš„è¿ç®—æ¯”å¾ªç¯å¿«)ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹æ ·æœ¬è¿›è¡Œè¡¥ 0ã€‚<code>LSTM()</code> çš„ <code>return_sequence</code> å‚æ•°å†³å®šè¿”å›æ‰€æœ‰çš„éšè—çŠ¶æ€è¿˜æ˜¯åªè¿”å›æœ€åä¸€ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚</p><h2 id="å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</h2><ol type="1"><li>å´æ©è¾¾. DeepLearning.</li></ol></div><div class="reward-container"><div>ç–å½±æ¨ªæ–œæ°´æ¸…æµ…ï¼Œæš—é¦™æµ®åŠ¨æœˆé»„æ˜</div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> æ‰“èµ</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="/images/wechatpay.png" alt="Randy Peng å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div style="display:inline-block"> <img src="/images/alipay.png" alt="Randy Peng æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>æœ¬æ–‡ä½œè€…ï¼š</strong> Randy Peng</li><li class="post-copyright-link"> <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="https://pengzhendong.cn/2018/08/31/emojify/" title="Emojify æ–‡æœ¬æƒ…æ„Ÿåˆ†æ">https://pengzhendong.cn/2018/08/31/emojify/</a></li><li class="post-copyright-license"> <strong>ç‰ˆæƒå£°æ˜ï¼š</strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div><center><br><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5aa9d6309315fb5e" async="async"></script></div></center><footer class="post-footer"><div class="post-tags"> <a href="/tags/Deep-Learning/" rel="tag"># Deep Learning</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2018/08/28/jazz-with-an-lstm-network/" rel="prev" title="ç”¨ LSTM ç½‘ç»œåˆ›ä½œçˆµå£«ç‹¬å¥"><i class="fa fa-chevron-left"></i> ç”¨ LSTM ç½‘ç»œåˆ›ä½œçˆµå£«ç‹¬å¥</a></div><div class="post-nav-item"> <a href="/2018/08/31/word-vector-representation/" rel="next" title="è¯å‘é‡è¡¨ç¤º">è¯å‘é‡è¡¨ç¤º<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview"> ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baseline-æ¨¡å‹-emojifier-v1"><span class="nav-number">2.</span> <span class="nav-text">Baseline æ¨¡å‹: Emojifier-V1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#emojifier-v1-æ¦‚å†µ"><span class="nav-number">2.1.</span> <span class="nav-text">Emojifier-V1 æ¦‚å†µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ç°-emojifier-v1"><span class="nav-number">2.2.</span> <span class="nav-text">å®ç° Emojifier-V1</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#emojifier-v2-åœ¨-keras-ä¸­ä½¿ç”¨-lstms"><span class="nav-number">3.</span> <span class="nav-text">Emojifier-V2: åœ¨ Keras ä¸­ä½¿ç”¨ LSTMs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#embedding-å±‚"><span class="nav-number">3.1.</span> <span class="nav-text">Embedding å±‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ„å»ºæ¨¡å‹"><span class="nav-number">3.2.</span> <span class="nav-text">æ„å»ºæ¨¡å‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">4.</span> <span class="nav-text">æ€»ç»“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å‚è€ƒæ–‡çŒ®"><span class="nav-number">5.</span> <span class="nav-text">å‚è€ƒæ–‡çŒ®</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Randy Peng" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">Randy Peng</p><div class="site-description" itemprop="description">è·¯æ¼«æ¼«å…¶ä¿®è¿œå…® å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/pengzhendong" title="GitHub â†’ https://github.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/pengzhendong" title="Twitter â†’ https://twitter.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i> Twitter</a></span><span class="links-of-author-item"><a href="mailto:275331498@qq.com" title="E-Mail â†’ mailto:275331498@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.facebook.com/pengzhendong" title="FaceBook â†’ https://www.facebook.com/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i> FaceBook</a></span><span class="links-of-author-item"><a href="https://t.me/pengzhendong" title="Telegram â†’ https://t.me/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-telegram fa-fw"></i> Telegram</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/pengzhendong" title="çŸ¥ä¹ â†’ https://www.zhihu.com/people/pengzhendong" rel="noopener" target="_blank"><i class="fab fa-leanpub fa-fw"></i> çŸ¥ä¹</a></span><span class="links-of-author-item"><a href="https://weibo.com/qq275331498" title="å¾®åš â†’ https://weibo.com/qq275331498" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i> å¾®åš</a></span><span class="links-of-author-item"><a href="/about" target="_self" title="å…³äº â†’ /about" target="_self"><i class="fa fa-user fa-fw"></i> å…³äº</a></span></div><hr style="margin-top:20px;margin-bottom:20px"> <img src="/images/wechat.png"></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 â€“ <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Randy Peng</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span title="ç«™ç‚¹æ€»å­—æ•°">258k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">3:55</span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"YHMwvrTgcfDjOXmiGY3jQ2r5-gzGzoHsz","app_key":"JRfKfM8mRPgxMB9GOSAnix9W","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/algolia-search.js"></script><script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script></body></html>